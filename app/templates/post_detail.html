{% extends "base.html" %}

{% block content %}
  <div class="max-w-3xl mx-auto mb-10 bg-white rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg">
    
    <!-- Заголовок -->
    <h1 class="text-3xl font-bold text-gray-800 mb-4">{{ post.title }}</h1>

    <!-- Информация об авторе -->
    <div class="flex items-center space-x-3 text-gray-500 text-sm mb-3"> <!-- mb-3 вместо mb-6 -->
      <img src="{{ post.author.avatar(40) }}" alt="Avatar" class="w-8 h-8 rounded-full">
      <a href="{{ url_for('user', username=post.author.username) }}" class="font-medium hover:text-blue-600">
        {{ post.author.username }}
      </a>
      <span>•</span>
      <span>{{ moment(post.timestamp).format('LLL') }}</span>
    </div>

    <!-- Первое изображение, центрированное -->
    {% if post.images|length > 0 %}
      <div class="my-6 flex justify-center">
        <div class="rounded-lg overflow-hidden shadow-md w-full max-w-2xl">
          <img src="{{ post.images[0].url }}" alt="{{ post.images[0].caption or 'Post image' }}" class="w-full h-auto object-cover">
        </div>
      </div>
    {% endif %}

    <!-- Текст статьи -->
    <div class="prose max-w-none text-gray-700 mb-6 whitespace-pre-line">
      {{ post.body | safe }}
    </div>

    <!-- Кнопки действий -->
    <div class="mt-8 flex flex-wrap gap-4">
        <!-- Назад к списку статей -->
        <a href="{{ url_for('index') }}" 
          class="relative inline-flex items-center h-10 px-4 py-2 rounded-full bg-white border border-gray-300 text-gray-800 font-medium overflow-hidden group focus:outline-none shadow-sm hover:shadow-md transition-all duration-300">
            <i class="fas fa-arrow-left mr-2"></i>
            {{ _('Go home') }}
            <span class="absolute inset-0 bg-gradient-to-r from-indigo-50 to-purple-50 opacity-0 group-hover:opacity-30 transition-opacity duration-300"></span>
        </a>

        <!-- Редактировать и удалить -->
        {% if current_user == post.author %}
            <div class="flex flex-wrap gap-3">
                <!-- Редактировать -->
                <a href="{{ url_for('edit_post', id=post.id) }}" 
                  class="relative inline-flex items-center h-10 px-4 py-2 rounded-full text-white font-medium overflow-hidden group focus:outline-none transition-all duration-300">
                    <span class="absolute inset-0 bg-gradient-to-r from-blue-500 to-indigo-600"></span>
                    <i class="fas fa-edit mr-2"></i>
                    <span class="relative z-10 flex items-center">{{ _('Edit') }}</span>
                    <span class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></span>
                </a>

                <!-- Удалить -->
                <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" class="mb-0">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" 
                            onclick="return confirmDelete(event)"
                            class="relative inline-flex items-center h-10 px-4 py-2 rounded-full text-white font-medium overflow-hidden group focus:outline-none transition-all duration-300">
                        <span class="absolute inset-0 bg-gradient-to-r from-red-500 to-orange-500"></span>
                        <i class="fas fa-trash-alt mr-2"></i>
                        <span class="relative z-10 flex items-center">{{ _('Delete') }}</span>
                        <span class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></span>
                    </button>
                </form>
            </div>
        {% endif %}
    </div>
  </div>
{% endblock %}


<!-- Подтверждение удаления -->
<script>
    function confirmDelete(event) {
        const isConfirmed = confirm("Are you sure you want to delete this post?");
        if (!isConfirmed) {
            event.preventDefault();
            return false;
        }
        return true;
    }
</script>